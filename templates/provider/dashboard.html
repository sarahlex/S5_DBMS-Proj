{% extends "base_dashboard.html" %}



{% block title %}Provider Dashboard{% endblock %}



{% block sidebar %}

<div class="sidebar">

    <div class="sidebar-brand">

        <h3><i class="fas fa-briefcase me-2"></i>Provider</h3>

    </div>

    <div class="sidebar-nav">

        <ul class="nav flex-column">

            <li class="nav-item">

                <a class="nav-link active" href="{{ url_for('provider_dashboard') }}">

                    <i class="fas fa-tachometer-alt"></i>Dashboard

                </a>

            </li>

            <li class="nav-item">

                <a class="nav-link" href="{{ url_for('provider_sponsorships') }}">

                    <i class="fas fa-handshake"></i>Sponsorship Opportunities

                </a>

            </li>

            <li class="nav-item">

                <a class="nav-link" href="{{ url_for('provider_accepted_sponsorships') }}">

                    <i class="fas fa-check-circle"></i>Accepted Sponsorships

                </a>

            </li>

             <li class="nav-item">

                <a class="nav-link" href="{{ url_for('provider_available_events') }}">

                    <i class="fas fa-calendar-alt"></i>Available Events

                </a>

            </li>

            <li class="nav-item">

                <a class="nav-link" href="#myservices" onclick="scrollToSection('myservices')">

                    <i class="fas fa-concierge-bell"></i>My Services

                </a>

            </li>

            <li class="nav-item">

                <a class="nav-link" href="#mybookings" onclick="scrollToSection('mybookings')">

                    <i class="fas fa-bookmark"></i>My Bookings

                </a>

            </li>

        </ul>

    </div>

</div>



<script>

function scrollToSection(sectionId) {

    document.getElementById(sectionId).scrollIntoView({ behavior: 'smooth' });

}

</script>

{% endblock %}



{% block content %}

<div class="d-flex justify-content-between align-items-center mb-4">

    <h2 class="mb-0"><i class="fas fa-tachometer-alt me-2"></i>Provider Dashboard</h2>

    <a href="{{ url_for('add_service') }}" class="btn btn-primary">

        <i class="fas fa-plus-circle me-2"></i>Add New Service

    </a>

</div>



<div class="row mb-4">

    <div class="col-md-3">

        <div class="stat-card">

            <div class="stat-number">{{ services|length }}</div>

            <div class="stat-label">Total Services</div>

        </div>

    </div>

    <div class="col-md-3">

        <div class="stat-card">

            <div class="stat-number">{{ bookings|length }}</div>

            <div class="stat-label">Total Bookings</div>

        </div>

    </div>

    <div class="col-md-3">

        <div class="stat-card">

            <div class="stat-number">

                {{ bookings|selectattr("status", "equalto", "confirmed")|list|length }}

            </div>

            <div class="stat-label">Confirmed</div>

        </div>

    </div>

    <div class="col-md-3">

        <div class="stat-card">

            <div class="stat-number">

                {{ bookings|selectattr("status", "equalto", "pending")|list|length }}

            </div>

            <div class="stat-label">Pending</div>

        </div>

    </div>

</div>



<div class="row">

    <div class="col-lg-6">

        <div class="card" id="myservices">

            <div class="card-header">

                <h5 class="mb-0"><i class="fas fa-concierge-bell me-2"></i>My Services</h5>

            </div>

            <div class="card-body">

                {% if services %}

                    {% for service in services %}

                    <div class="card service-card mb-3 {% if service.availability != 'Available' %}unavailable{% endif %}">

                        <div class="card-body">

                            <div class="d-flex justify-content-between align-items-start mb-2">

                                <h6 class="card-title mb-0">{{ service.service_name }}</h6>

                                <span class="badge {% if service.availability == 'Available' %}bg-success{% else %}bg-secondary{% endif %}">

                                    {{ service.availability }}

                                </span>

                            </div>

                            <p class="card-text mb-2">

                                <i class="fas fa-tag me-2 text-primary"></i>

                                <strong>Price:</strong> ${{ service.price }}

                            </p>

                            {% if service.description %}

                            <p class="card-text small text-muted mb-3">

                                {{ service.description }}

                            </p>

                            {% endif %}

                            <div class="d-flex gap-2">

                                <a href="{{ url_for('edit_service', service_id=service.service_id) }}" class="btn btn-outline-primary btn-sm">

                                    <i class="fas fa-edit me-1"></i>Edit

                                </a>

                                <!-- THIS IS THE CORRECTED DELETE BUTTON -->

                                <a href="{{ url_for('delete_service', service_id=service.service_id) }}"

                                   class="btn btn-outline-danger btn-sm"

                                   onclick="return confirm('Are you sure you want to delete this service? All associated bookings will also be permanently deleted. This action cannot be undone.')">

                                    <i class="fas fa-trash me-1"></i>Delete

                                </a>

                            </div>

                        </div>

                    </div>

                    {% endfor %}

                {% else %}

                    <div class="text-center py-4">

                        <i class="fas fa-concierge-bell fa-2x text-muted mb-3"></i>

                        <p class="text-muted mb-3">No services added yet.</p>

                        <a href="{{ url_for('add_service') }}" class="btn btn-primary btn-sm">

                            <i class="fas fa-plus-circle me-2"></i>Add Your First Service

                        </a>

                    </div>

                {% endif %}

            </div>

        </div>

    </div>



    <div class="col-lg-6">

        <div class="card" id="mybookings">

            <div class="card-header">

                <h5 class="mb-0"><i class="fas fa-bookmark me-2"></i>My Bookings</h5>

            </div>

            <div class="card-body">

                {% if bookings %}

                    <div class="table-responsive">

                        <table class="table table-hover">

                            <thead>

                                <tr>

                                    <th>Service</th>

                                    <th>Event</th>

                                    <th>Organizer</th>

                                    <th>Status</th>

                                    <th>Date</th>

                                </tr>

                            </thead>

                            <tbody>

                                {% for booking in bookings %}

                                <tr>

                                    <td>

                                        <strong>{{ booking.service_name }}</strong>

                                    </td>

                                    <td>{{ booking.event_name }}</td>

                                    <td>

                                        <small>

                                            <i class="fas fa-user me-1"></i>{{ booking.organizer_name }}<br>

                                            <i class="fas fa-phone me-1"></i>{{ booking.organizer_phone }}

                                        </small>

                                    </td>

                                    <td>

                                        <span class="badge {% if booking.status == 'confirmed' %}bg-success{% elif booking.status == 'pending' %}bg-warning{% else %}bg-danger{% endif %}">

                                            {{ booking.status|title }}

                                        </span>

                                    </td>

                                    <td>

                                        <small>{{ booking.booked_at.strftime('%m/%d/%Y') if booking.booked_at else 'N/A' }}</small>

                                    </td>

                                </tr>

                                {% endfor %}

                            </tbody>

                        </table>

                    </div>



                    <div class="row mt-3">

                        <div class="col-md-4">

                            <div class="stat-card">

                                <div class="stat-number">${{ bookings|sum(attribute='price')|default(0) }}</div>

                                <div class="stat-label">Total Revenue</div>

                            </div>

                        </div>

                        <div class="col-md-4">

                            <div class="stat-card">

                                <div class="stat-number">{{ bookings|selectattr("status", "equalto", "confirmed")|list|length }}</div>

                                <div class="stat-label">Confirmed</div>

                            </div>

                        </div>

                        <div class="col-md-4">

                            <div class="stat-card">

                                <div class="stat-number">{{ bookings|selectattr("status", "equalto", "pending")|list|length }}</div>

                                <div class="stat-label">Pending</div>

                            </div>

                        </div>

                    </div>

                {% else %}

                    <div class="text-center py-4">

                        <i class="fas fa-bookmark fa-2x text-muted mb-3"></i>

                        <p class="text-muted">No bookings yet.</p>

                        <p class="text-muted small">When organizers book your services, they will appear here.</p>

                    </div>

                {% endif %}

            </div>

        </div>

    </div>

</div>

{% endblock %}



